function Viewport(e){this.controller=e,this.mapWidth=e.width,this.mapHeight=e.height,this.centerY=e.height/2,this.centerX=e.width/2,this.size=paper.view.size,this.center=paper.view.center,this.zoomLevel=1,this.endpoints=new Map,this.offmap_ep=[],this.alertList=[],this.rays=new Map,this.alerts=e.alertQueue,this.animQueue=new AnimationQueue,this.map=new Raster(e.map),this.initializeMap(),this.redraw()}Viewport.prototype.constructor=Viewport,Viewport.prototype.process=function(e){for((this.size.width!=paper.view.size.width||this.size.height!=paper.view.size.height)&&(this.size=paper.view.size,this.center=paper.view.center,newmap=new Raster(this.controller.map),this.map.replaceWith(newmap),this.map=newmap,this.initializeMap(),this.map.scale(this.zoomLevel),this.redraw(),ui.reposition());0<this.alerts.length;)a=this.alerts.shift(),s=this.updateAndDisplay(a.src),d=this.updateAndDisplay(a.dst),r=new Ray(s,d,this.getRayColor(a.type),this),this.alertList.push(a),this.alertList.length>this.controller.config.alertListSize&&this.alertList.shift();this.animQueue.process(e),this.cullEndpoints()},Viewport.prototype.updateAndDisplay=function(e){var f;return this.endpoints.has(e)?(f=this.endpoints.get(e),f.changed=Date.now(),f.show()):e.offmap?(this.offmap_ep.push(e),f=new EndpointGraphic(new Point(0,0),e.ip,e.label,this.getEPColor(e.type),this.animQueue,!0),this.endpoints.set(e,f),f.show(),this.repositionOffMapEPs()):(f=new EndpointGraphic(this.xlatMapCoords(e.x,e.y),e.ip,e.label,this.getEPColor(e.type),this.animQueue,!1),this.endpoints.set(e,f),f.show()),f},Viewport.prototype.cullEndpoints=function(){var e=this;curr_time=Date.now(),this.endpoints.forEach(function(f){!1==f.hidden&&curr_time-f.changed>e.controller.config.ep_timeout&&f.hide()})},Viewport.prototype.repositionOffMapEPs=function(){for(screenAspect=this.size.width/this.size.height,mapAspect=this.mapWidth/this.mapHeight,coordScale=1,coordScale=mapAspect>screenAspect?this.mapWidth/this.size.width:this.mapHeight/this.size.height,i=0;i<this.offmap_ep.length;i++)x=0,y=0,null!=this.endpoints.get(this.offmap_ep[i]).ico_group&&(0==i%4||2==i%4?0==i%4?(epwidth=this.endpoints.get(this.offmap_ep[i]).ico_group.bounds.width,epheight=this.endpoints.get(this.offmap_ep[i]).ico_group.bounds.height,map_delta_x=epwidth*coordScale,map_delta_y=epheight*coordScale,x=map_delta_x/2,y=this.mapHeight-1.5*map_delta_y-Math.floor(Math.ceil((i-i%4)/4)/Math.ceil(this.offmap_ep.length/4)*(this.mapHeight-1.5*map_delta_y)),this.offmap_ep[i].x=x,this.offmap_ep[i].y=y,this.endpoints.get(this.offmap_ep[i]).reposition(this.xlatMapCoords(x,y))):(epwidth=this.endpoints.get(this.offmap_ep[i]).ico_group.bounds.width,epheight=this.endpoints.get(this.offmap_ep[i]).ico_group.bounds.height,map_delta_x=epwidth*coordScale,map_delta_y=epheight*coordScale,x=this.mapWidth-map_delta_x/2,y=1.5*map_delta_y+Math.floor(Math.ceil((i-i%4)/4)/Math.ceil(this.offmap_ep.length/4)*(this.mapHeight-1.5*map_delta_y)),this.offmap_ep[i].x=x,this.offmap_ep[i].y=y,this.endpoints.get(this.offmap_ep[i]).reposition(this.xlatMapCoords(x,y))):1==i%4?(epwidth=this.endpoints.get(this.offmap_ep[i]).ico_group.bounds.width,epheight=this.endpoints.get(this.offmap_ep[i]).ico_group.bounds.height,map_delta_x=epwidth*coordScale,map_delta_y=epheight*coordScale,y=map_delta_y/2,x=this.mapWidth-1.5*map_delta_x-Math.floor(Math.ceil((i-i%4)/4)/Math.ceil(this.offmap_ep.length/4)*(this.mapWidth-1.5*map_delta_x)),this.offmap_ep[i].x=x,this.offmap_ep[i].y=y,this.endpoints.get(this.offmap_ep[i]).reposition(this.xlatMapCoords(x,y))):(epwidth=this.endpoints.get(this.offmap_ep[i]).ico_group.bounds.width,epheight=this.endpoints.get(this.offmap_ep[i]).ico_group.bounds.height,map_delta_x=epwidth*coordScale,map_delta_y=epheight*coordScale,y=this.mapHeight-map_delta_y/2,x=1.5*map_delta_x+Math.floor(Math.ceil((i-i%4)/4)/Math.ceil(this.offmap_ep.length/4)*(this.mapWidth-1.5*map_delta_x)),this.offmap_ep[i].x=x,this.offmap_ep[i].y=y,this.endpoints.get(this.offmap_ep[i]).reposition(this.xlatMapCoords(x,y))))},Viewport.prototype.getEPColor=function(e){return new Color(this.controller.config.getEPColor(e))},Viewport.prototype.getRayColor=function(e){return new Color(this.controller.config.getRayColor(e))},Viewport.prototype.xlatMapCoords=function(e,f){var h,j,B,k=this.size.width,m=this.size.height,n=this.center.x,q=this.center.y,v=e-this.centerX,w=f-this.centerY,A=this.mapWidth/this.mapHeight;return B=A>k/m?k/this.mapWidth:m/this.mapHeight,h=Math.round(n+v*B*this.zoomLevel),j=Math.round(q+w*B*this.zoomLevel),new Point(h,j)},Viewport.prototype.fitToScreen=function(){this.centerX=height/2,this.centerY=width/2,this.zoomLevel=1,this.redraw()},Viewport.prototype.zoomIn=function(){prev=this.zoomLevel,this.zoomLevel+=this.controller.config.zoomRate,this.zoomLevel>this.controller.config.maxZoom&&(this.zoomLevel=this.controller.config.maxZoom),this.map.scale(this.zoomLevel/prev),this.redraw()},Viewport.prototype.zoomOut=function(){prev=this.zoomLevel,this.zoomLevel-=this.controller.config.zoomRate,1>this.zoomLevel&&(this.zoomLevel=1),this.map.scale(this.zoomLevel/prev),this.redraw()},Viewport.prototype.recenter=function(e){var f=this.size.width,h=this.size.height,j=this.center.x,k=this.center.y,m=e.x-j,n=e.y-k,v=this.mapWidth/this.mapHeight,w;w=v>f/h?this.mapWidth/f:this.mapHeight/h,this.centerX+=m*w/this.zoomLevel,this.centerY+=n*w/this.zoomLevel,this.redraw()},Viewport.prototype.initializeMap=function(){var e=this.size.width,f=this.size.height,h,k=this.mapWidth/this.mapHeight;h=k>e/f?e/this.mapWidth:f/this.mapHeight,this.map.scale(h),this.map.position=this.xlatMapCoords(this.mapWidth/2,this.mapHeight/2)},Viewport.prototype.redraw=function(){var e=this;this.map.position=this.xlatMapCoords(this.mapWidth/2,this.mapHeight/2),this.endpoints.forEach(function(f,h){f.reposition(e.xlatMapCoords(h.x,h.y))}),this.rays.forEach(function(f){f.update()})},Viewport.prototype.reloadMap=function(e){paper.project.activeLayer.removeChildren(),paper.view.draw(),this.controller.loadMap(e),asyncRestart()};function AnimationQueue(){this.queue=new Map}AnimationQueue.prototype.constructor=AnimationQueue,AnimationQueue.prototype.addObject=function(e){this.queue.set(e,e)},AnimationQueue.prototype.removeObject=function(e){this.queue.delete(e)},AnimationQueue.prototype.currentQueue=function(){return this.queue.values()},AnimationQueue.prototype.process=function(e){this.queue.forEach(function(f){f.doAnimation(e)})};function Ray(e,f,h,j){var k=new Path;k.add(e.position,f.position);var m=k.getNormalAt(k.length/2)*(k.length/8);0<=m.angle&&270>m.angle&&(m.angle+=180);var n=k.getPointAt(k.length/2)+m;k.remove();var q=new Gradient,v=new Color(h);v.alpha=0;var w=new Color(h);w.alpha=0;var z=new Color(h);z.alpha=0,q.stops=[v,w,z];var A=new Color(q,e.position,f.position);k=new Path.Arc(e.position,n,f.position),k.visible=!1,k.strokeWidth=j.controller.config.rayGlow,k.opacity=.5,k.strokeColor=A.clone(),path2=k.clone(),path2.strokeWidth=j.controller.config.raySize,path2.opacity=1,path2.strokeColor=A.clone(),e.ico_group.bringToFront(),f.ico_group.bringToFront(),this.color=h,this.main=path2,this.glow=k,this.src=e,this.dst=f,this._animTimer=0,this._animQueue=j.animQueue,this._viewport=j,this._viewport.rays.set(this,this),this._animQueue.addObject(this),this.main.visible=!0,this.glow.visible=!0}Ray.prototype.constructor=Ray,Ray.prototype.doAnimation=function(e){var f=viewport.controller.config.raySpeed;this._animTimer+=e;var h=this._animTimer/f;if(1>=h){var j=new Color(this.color),k=new Color(this.color),m=new Color(this.color);j.alpha=.25>h?4*h:.5>h?2-4*h:0,k.alpha=.5>h?2*h:.75>h?1-4*(h-.5):0,m.alpha=.25>h?0:.75>h?2*(h-.25):1-4*h;var n=new Gradient;n.stops=[j,k,m],gc=new Color(n,this.src.position,this.dst.position),this.main.strokeColor=gc.clone(),this.glow.strokeColor=gc.clone()}else this._animQueue.removeObject(this),this._viewport.rays.delete(this),this.main.remove(),this.glow.remove(),this.main=null,this.glow=null},Ray.prototype.update=function(){if(null!=this.main){var e=new Path;e.add(this.src.position,this.dst.position);var f=e.getNormalAt(e.length/2)*(e.length/8);0<=f.angle&&270>f.angle&&(f.angle+=180);var h=e.getPointAt(e.length/2)+f;e.remove(),e=new Path.Arc(this.src.position,h,this.dst.position),e.visible=!1,e.strokeWidth=viewport.controller.config.rayGlow,e.opacity=.2,e.strokeColor=this.glow.strokeColor.clone(),path2=e.clone(),path2.strokeWidth=viewport.controller.config.raySize,path2.opacity=.8,path2.strokeColor=this.main.strokeColor.clone(),this.main.remove(),this.glow.remove(),this.main=path2,this.glow=e,this.main.visible=!0,this.glow.visible=!0}};function EndpointGraphic(e,f,h,j,k,m){this.position=e,this.color=j,this.ip=f,this.label=h,this.off_map=m,this.icon=null,this.glow=null,this.text=null,this.text2=null,this.ext_box=null,this.ico_group=null,this._animQueue=k,this._animMode=0,this._animTimer=0,this.changed=Date.now(),this.hidden=!1}EndpointGraphic.prototype.constructor=EndpointGraphic,EndpointGraphic.prototype.show=function(){var e=viewport.controller.config.endpointSize;if(null==this.ico_group){null==this.glow?this.glow=new Path.Circle(this.position,e+2):this.glow.opacity=0,null==this.icon?this.icon=new Path.Circle(this.position,e):this.icon.opacity=1;var f=new PointText(this.position+new Point(0,e+10));f.justification='center',f.fontSize=viewport.controller.config.labelFontSize,f.fillColor=viewport.controller.config.labelFontColor,f.content=this.ip,this.text=f,this.glow.opacity=0,this.glow.strokeColor=this.color.clone(),this.glow.strokeWidth=viewport.controller.config.endpointGlow,this.glow.visible=!0,this.icon.fillColor=this.color.clone(),this.icon.visible=!0;var h=new PointText(this.position+new Point(0,e-25));h.justification='center',h.fontSize=viewport.controller.config.labelFontSize,h.fillColor=viewport.controller.config.labelFontColor,h.content=this.label,this.text2=h,h.visible=this.off_map||viewport.controller.config.showLocalLabels,this.ico_group=new Group([this.icon,this.text,this.text2,this.glow]),this.text2.bringToFront(),this.ext_box=new Path.Rectangle(this.ico_group.bounds,10),this.ext_box.fillColor=viewport.controller.config.endpointExternalColor,this.ext_box.scale(1.2);this.ext_box.opacity=this.off_map?.5:0;this.ico_group.addChild(this.ext_box),this.ext_box.sendToBack(),this.ico_group.position=this.position,this._fadein()}else this.quickhighlight();this.hidden=!1},EndpointGraphic.prototype.reposition=function(e){this.position=e,null!=this.ico_group&&(this.ico_group.position=e,this.ico_group.visible=!0)},EndpointGraphic.prototype.hide=function(){this.hidden=!0,null!=this.icon&&this._fadeout()},EndpointGraphic.prototype.highlight=function(){this._animMode=2,this._animTimer=0,this.icon.opacity=1,this._animQueue.addObject(this)},EndpointGraphic.prototype.quickhighlight=function(){this._animMode=4,this._animTimer=0,this.icon.opacity=1,this._animQueue.addObject(this)},EndpointGraphic.prototype._fadein=function(){this._animMode=1,this._animTimer=0,this.icon.opacity=0,this._animQueue.addObject(this)},EndpointGraphic.prototype._fadeout=function(){this._animMode=3,this._animTimer=0,this.icon.opacity=1,this._animQueue.addObject(this)},EndpointGraphic.prototype.doAnimation=function(e){var f=viewport.controller.config.endpointFadeinRate,h=viewport.controller.config.endpointFadeoutRate,j=viewport.controller.config.endpointHighlightRate;this._animTimer+=e,null!=this.icon&&(1==this._animMode&&(o=this._animTimer/f,1>=o&&(this.icon.opacity=o,this.text.opacity=o),norm=this.color.brightness,p=this._animTimer/j,.1>=p?(this.icon.fillColor.brightness=norm+10*(1-norm)*p,this.glow.opacity=5*p):1>=p?(this.icon.fillColor.brightness=norm+1.1111*(1-norm)*(1-p),this.glow.opacity=.555556*(1-p)):(this._animMode=0,this.icon.fillColor.brightness=norm,this.glow.opacity=0,this._animQueue.removeObject(this))),2==this._animMode&&(norm=this.color.brightness,p=this._animTimer/j,.5>=p?(this.icon.fillColor.brightness=norm+2*(1-norm)*p,this.glow.opacity=p):1>=p?(this.icon.fillColor.brightness=norm+2*(1-norm)*(1-p),this.glow.opacity=1-p):(this._animMode=0,this.icon.fillColor.brightness=norm,this.glow.opacity=0,this._animQueue.removeObject(this))),4==this._animMode&&(norm=this.color.brightness,p=this._animTimer/j,.1>=p?(this.icon.fillColor.brightness=norm+10*(1-norm)*p,this.glow.opacity=5*p):1>=p?(this.icon.fillColor.brightness=norm+1.1111*(1-norm)*(1-p),this.glow.opacity=.555556*(1-p)):(this._animMode=0,this.icon.fillColor.brightness=norm,this.glow.opacity=0,this._animQueue.removeObject(this))),3==this._animMode&&(o=1-this._animTimer/h,0<=o?(this.icon.opacity=o,this.text.opacity=o):(this._animMode=0,this._animQueue.removeObject(this),this.ico_group.remove(),this.icon=null,this.glow=null,this.ico_group=null)))};function UIControls(){this.scrollingY=0,this.scrollingX=0,this.zoomingIn=0,this.zoomingOut=0,this.fading=0,this.uiFadeRate=2,this.pinned=!0,this.tempShow=!1,this.uiGroup=null,this.navGroup=null,this.titleGroup=null,this.alertGroup=null,this.alertBox1=null,this.alertBox2=null,this.alertListLines=Array(viewport.controller.config.alertListSize),this.settingsGroup=null,this.settingsBox1=null,this.settingsBox2=null,this.connectionText=null}UIControls.prototype.constructor=UIControls,UIControls.prototype.init=function(){this.navGroup=this.createNavButtons(paper.view.bounds.bottomRight-new Point(75,75)),this.titleGroup=this.createTitleHeader(paper.view.bounds.topLeft+new Point(100,50)),this.alertGroup=this.createAlertList(new Point(0,0)),this.alertGroup.position=paper.view.bounds.bottomRight-new Point(alertGroup.bounds.width/2+this.navGroup.bounds.width+40,this.alertGroup.bounds.height/2+10),this.alertGroup.visible=!1,this.settingsGroup=this.createControlPanel(paper.view.bounds.center),this.settingsGroup.visible=!1,this.uiGroup=new Group([this.titleGroup,this.navGroup,this.alertGroup,this.settingsGroup]),myui=this},UIControls.prototype.reposition=function(){this.navGroup.position=paper.view.bounds.bottomRight-new Point(75,75),this.titleGroup.position=paper.view.bounds.topLeft+new Point(100,50),isVisible=this.alertGroup.visible,this.alertGroup.remove(),this.alertGroup=this.createAlertList(new Point(0,0)),this.alertGroup.position=paper.view.bounds.bottomRight-new Point(alertGroup.bounds.width/2+this.navGroup.bounds.width+40,this.alertGroup.bounds.height/2+10),this.alertGroup.visible=isVisible,isVisible=this.settingsGroup.visible,this.settingsGroup.remove(),this.settingsGroup=this.createControlPanel(paper.view.bounds.center),this.settingsGroup.visible=isVisible,this.uiGroup.addChildren([this.alertGroup,this.settingsGroup])},UIControls.prototype.doUpdates=function(e){for((0!=this.scrollingX||0!=this.scrollingY)&&(this.scrollDisplay(new Point(this.scrollingX,this.scrollingY)),this.scrollingX*=viewport.controller.config.scrollRate,this.scrollingY*=viewport.controller.config.scrollRate),0!=this.zoomingIn&&(this.zoomingIn-=1,0==this.zoomingIn&&(viewport.zoomIn(),this.zoomingIn=3)),0!=this.zoomingOut&&(this.zoomingOut-=1,0==this.zoomingOut&&(viewport.zoomOut(),this.zoomingOut=3)),maxStrLen=Math.floor((paper.view.size.width-this.navGroup.bounds.width-45)/Math.ceil(0.56*viewport.controller.config.alertListFontSize)),al=Array.from(viewport.alertList),al.reverse(),i=0;i<al.length;i++)null!=al[i]&&(tempStr=new Date(al[i].alertTime).toUTCString()+'['+al[i].type+'] '+al[i].src.ip,(al[i].src.offmap||viewport.controller.config.showLocalLabels)&&''!=al[i].src.label&&(tempStr+=' ('+al[i].src.label+')'),tempStr+='-> '+al[i].dst.ip,(al[i].dst.offmap||viewport.controller.config.showLocalLabels)&&''!=al[i].dst.label&&(tempStr+=' ('+al[i].dst.label+')'),tempStr+=' \''+al[i].msg+'\'',this.alertListLines[i].content=tempStr.substring(0,maxStrLen));this.connectionText.content='Last update: '+new Date(viewport.controller.lastUpdate).toUTCString(),0>this.fading?(this.fading+=e,0<this.fading&&(this.fading=0),0==this.fading?this.uiGroup.opacity=.1:this.fading>=-1*this.uiFadeRate&&(this.uiGroup.opacity-=(this.uiGroup.opacity-.1)/this.uiFadeRate*(this.uiFadeRate- -1*this.fading))):0<this.fading?(this.fading-=e,0>this.fading&&(this.fading=0),0==this.fading?this.uiGroup.opacity=1:this.fading<=this.uiFadeRate&&(this.uiGroup.opacity+=(1-this.uiGroup.opacity)/this.uiFadeRate*(this.uiFadeRate-this.fading))):this.pinned||this.tempShow?this.uiGroup.opacity=1:this.uiGroup.opacity=.1,this.uiGroup.bringToFront()},UIControls.prototype.scrollDisplay=function(e){null!=viewport&&viewport.recenter(viewport.xlatMapCoords(viewport.centerX,viewport.centerY)-e)},UIControls.prototype.fadeOut=function(e){!1==this.pinned&&(this.tempShow=!1,0<=this.fading&&(this.fading>=this.uiFadeRate?this.fading=0:this.fading=-1*(this.uiFadeRate+e)))},UIControls.prototype.fadeIn=function(e){!1==this.pinned&&(this.tempShow=!0,0>=this.fading&&(this.fading<=-1*this.uiFadeRate?this.fading=0:this.fading=this.uiFadeRate+e))},UIControls.prototype.createTitleHeader=function(e){var f=this;return outlineColor=viewport.controller.config.UIOutlineColor,fillColor=viewport.controller.config.UIFillColor,t=new PointText,t.justification='center',t.fontSize=viewport.controller.config.logoFontSize,t.fillColor=outlineColor,t.content=' '+viewport.controller.config.logoText+' ',t.opacity=.9,t.onMouseDown=function(){f.alertGroup.visible=!f.alertGroup.visible},b=new Path.Rectangle(t.bounds,10),b.strokeColor=outlineColor,b.fillColor=fillColor,b.opacity=.5,b.onMouseDown=function(){f.alertGroup.visible=!f.alertGroup.visible},f=this,b.on('mouseenter',function(){f.fadeIn(0)}),b.on('mouseleave',function(){f.fadeOut(1)}),titleGroup=new Group([t,b]),titleGroup.position=e,titleGroup},UIControls.prototype.createNavButtons=function(e){var f=this;return buttonOutlineColor=viewport.controller.config.UIOutlineColor,buttonFillColor=viewport.controller.config.UIFillColor,csym1=new Path.Circle(new Point(0,0),5),csym1.strokeColor=buttonOutlineColor,csym1.strokeWidth=2,csym1.opacity=.8,csym2=new Path.Rectangle(new Point(0,0),new Point(2,16)),csym2.fillColor=buttonOutlineColor,csym2.opacity=.8,csym2.position=csym1.position,csym3=new Path.Rectangle(new Point(0,0),new Point(16,2)),csym3.fillColor=buttonOutlineColor,csym3.opacity=.8,csym3.position=csym1.position,csym=new Group([csym1,csym2,csym3]),c1=new Path.Circle(new Point(0,0),15),c1.strokeColor=buttonOutlineColor,c1.fillColor=buttonFillColor,c1.opacity=.5,c1.onMouseDown=function(){null!=viewport&&viewport.recenter(viewport.xlatMapCoords(viewport.mapWidth/2,viewport.mapHeight/2)),this.fillColor.brightness=1},c1.onMouseUp=function(){this.fillColor.brightness=.85},c1.onMouseEnter=function(){this.fillColor.brightness=.85,f.fadeIn(0)},c1.onMouseLeave=function(){this.fillColor.brightness=.7,f.fadeOut(1)},csym.position=c1.position,c=new Group([csym,c1]),zisym=new PointText,zisym.justification='center',zisym.fontSize=28,zisym.fillColor=buttonOutlineColor,zisym.content='+',zisym.opacity=.8,zi=new Path.Circle(new Point(-40,-40),15),zi.strokeColor=buttonOutlineColor,zi.fillColor=buttonFillColor,zi.opacity=.5,zi.onMouseDown=function(){f.zoomingIn=3,this.fillColor.brightness=1},zi.onMouseUp=function(){f.zoomingIn=0,this.fillColor.brightness=.85},zi.onMouseEnter=function(){this.fillColor.brightness=.85,f.fadeIn(0)},zi.onMouseLeave=function(){f.zoomingIn=0,this.fillColor.brightness=.7,f.fadeOut(1)},zisym.position=zi.position,zplus=new Group([zisym,zi]),zosym=new PointText,zosym.justification='center',zosym.fontSize=28,zosym.fillColor=buttonOutlineColor,zosym.content='-',zosym.opacity=.8,zo=new Path.Circle(new Point(40,-40),15),zo.strokeColor=buttonOutlineColor,zo.fillColor=buttonFillColor,zo.opacity=.5,zo.onMouseDown=function(){f.zoomingOut=3,this.fillColor.brightness=1},zo.onMouseUp=function(){f.zoomingOut=0,this.fillColor.brightness=.85},zo.onMouseEnter=function(){this.fillColor.brightness=.85,f.fadeIn(0)},zo.onMouseLeave=function(){f.zoomingOut=0,this.fillColor.brightness=.7,f.fadeOut(1)},zosym.position=zo.position,zminus=new Group([zosym,zo]),hisym1=new Path.Rectangle(new Point(0,0),new Point(12,2)),hisym1.fillColor=buttonOutlineColor,hisym1.opacity=.8,hisym2=new Path.Rectangle(new Point(3,3),new Point(9,7)),hisym2.fillColor=buttonOutlineColor,hisym2.opacity=.8,hisym3=new Path.Rectangle(new Point(0,8),new Point(12,10)),hisym3.fillColor=buttonOutlineColor,hisym3.opacity=.8,hisym4=new Path.Rectangle(new Point(5,11),new Point(7,19)),hisym4.fillColor=buttonOutlineColor,hisym4.opacity=.8,hisym=new Group([hisym1,hisym2,hisym3,hisym4]),hi=new Path.Circle(new Point(40,40),15),hi.strokeColor=buttonOutlineColor,hi.fillColor=buttonFillColor,hi.opacity=.5,hi.onMouseDown=function(){f.pinned?(f.pinned=!1,f.fadeOut(0),hisym.rotate(-90)):(f.fadeIn(0),f.pinned=!0,hisym.rotate(90)),this.fillColor.brightness=1},hi.onMouseUp=function(){this.fillColor.brightness=.85},hi.onMouseEnter=function(){this.fillColor.brightness=.85,f.fadeIn(0)},hi.onMouseLeave=function(){f.zoomingIn=0,this.fillColor.brightness=.7,f.fadeOut(1)},hisym.position=hi.position,hider=new Group([hisym,hi]),setsym1=new Path.Rectangle(new Point(0,0),new Point(12,2)),setsym1.fillColor=buttonOutlineColor,setsym1.opacity=.8,setsym2=new Path.Rectangle(new Point(0,5),new Point(12,7)),setsym2.fillColor=buttonOutlineColor,setsym2.opacity=.8,setsym3=new Path.Rectangle(new Point(0,10),new Point(12,12)),setsym3.fillColor=buttonOutlineColor,setsym3.opacity=.8,setsym=new Group([setsym1,setsym2,setsym3]),setb=new Path.Circle(new Point(-40,40),15),setb.strokeColor=buttonOutlineColor,setb.fillColor=buttonFillColor,setb.opacity=.5,setb.onMouseDown=function(){this.fillColor.brightness=1,f.settingsGroup.visible=!f.settingsGroup.visible},setb.onMouseUp=function(){this.fillColor.brightness=.85},setb.onMouseEnter=function(){this.fillColor.brightness=.85},setb.onMouseLeave=function(){f.zoomingIn=0,this.fillColor.brightness=.7,f.fadeOut(1)},setsym.position=setb.position,settings=new Group([setsym,setb]),u=new Path.RegularPolygon(new Point(0,-30),3,20),u.strokeColor=buttonOutlineColor,u.fillColor=buttonFillColor,u.opacity=.5,u.onMouseDown=function(){f.scrollingY=1,this.fillColor.brightness=1},u.onMouseUp=function(){f.scrollingY=0,this.fillColor.brightness=.85},u.onMouseEnter=function(){this.fillColor.brightness=.85,f.fadeIn(0)},u.onMouseLeave=function(){f.scrollingY=0,this.fillColor.brightness=.7,f.fadeOut(1)},l=u.clone(),l.position=new Point(-35,0),l.rotate(-90),l.onMouseDown=function(){f.scrollingX=1,this.fillColor.brightness=1},l.onMouseUp=function(){f.scrollingX=0,this.fillColor.brightness=.85},l.onMouseEnter=function(){this.fillColor.brightness=.85,f.fadeIn(0)},l.onMouseLeave=function(){f.scrollingX=0,this.fillColor.brightness=.7,f.fadeOut(1)},r=u.clone(),r.position=new Point(35,0),r.rotate(90),r.onMouseDown=function(){f.scrollingX=-1,this.fillColor.brightness=1},r.onMouseUp=function(){f.scrollingX=0,this.fillColor.brightness=.85},r.onMouseEnter=function(){this.fillColor.brightness=.85,f.fadeIn(0)},r.onMouseLeave=function(){f.scrollingX=0,this.fillColor.brightness=.7,f.fadeOut(1)},d=u.clone(),d.position=new Point(0,35),d.rotate(180),d.onMouseDown=function(){f.scrollingY=-1,this.fillColor.brightness=1},d.onMouseUp=function(){f.scrollingY=0,this.fillColor.brightness=.85},d.onMouseEnter=function(){this.fillColor.brightness=.85,f.fadeIn(0)},d.onMouseLeave=function(){f.scrollingY=0,this.fillColor.brightness=.7,f.fadeOut(1)},navGroup=new Group([u,l,r,d,c,zplus,zminus,hider,settings]),navGroup.position=e,navGroup},UIControls.prototype.createAlertList=function(e){for(outlineColor=viewport.controller.config.UIOutlineColor,fillColor=viewport.controller.config.UIFillColor,t=new PointText,t.justification='left',t.fontSize=viewport.controller.config.alertListFontSize+4,t.fillColor=outlineColor,t.content=' Latest Alerts ',t.opacity=.8,t.on('mouseenter',function(){myui.fadeIn(0)}),t.on('mouseleave',function(){myui.fadeOut(1)}),spacer=new Path.Rectangle(new Point(0,0),new Point(paper.view.size.width-this.navGroup.bounds.width-40,0)),alertGroup=new Group([spacer,t]),t.position=spacer.position,b=new Path.Rectangle(alertGroup.bounds,10),b.strokeColor=outlineColor,b.fillColor=fillColor,b.opacity=.9,b.on('mouseenter',function(){myui.fadeIn(0)}),b.on('mouseleave',function(){myui.fadeOut(1)}),alertGroup.addChild(b),b.sendToBack(),this.alertBox1=b,spacer.remove(),spacer=new Path.Rectangle(new Point(0,0),new Point(paper.view.size.width-this.navGroup.bounds.width-40,0)),alertLineGroup=new Group([spacer]),i=0;i<this.alertListLines.length;i++)l=new PointText,l.justification='left',l.fontSize=viewport.controller.config.alertListFontSize,l.fontFamily='monospace',l.fillColor=outlineColor,l.content='          ',l.opacity=.8,l.on('mouseenter',function(){myui.fadeIn(0)}),l.on('mouseleave',function(){myui.fadeOut(1)}),alertLineGroup.addChild(l),l.position=new Point(l.bounds.width/2+10,(l.bounds.height+5)*i+10),this.alertListLines[i]=l;return b=new Path.Rectangle(alertLineGroup.bounds,10),b.position=alertLineGroup.position,b.strokeColor=outlineColor,b.fillColor=fillColor,b.opacity=.9,b.on('mouseenter',function(){myui.fadeIn(0)}),b.on('mouseleave',function(){myui.fadeOut(1)}),alertLineGroup.addChild(b),b.sendToBack(),this.alertBox2=b,spacer.remove(),alertGroup.addChild(alertLineGroup),alertLineGroup.position=t.position+new Point(0,alertLineGroup.bounds.height/2+20),alertGroup.position=e,alertGroup},UIControls.prototype.createControlPanel=function(e){return outlineColor=viewport.controller.config.UIOutlineColor,fillColor=viewport.controller.config.UIFillColor,t=new PointText,t.justification='left',t.fontSize=viewport.controller.config.alertListFontSize+4,t.fillColor=outlineColor,t.content=' Settings ',t.opacity=1,t.on('mouseenter',function(){myui.fadeIn(0)}),t.on('mouseleave',function(){myui.fadeOut(1)}),spacer=new Path.Rectangle(new Point(0,0),new Point(800,0)),settingsGroup=new Group([spacer,t]),t.position=spacer.position,b=new Path.Rectangle(settingsGroup.bounds,10),b.strokeColor=outlineColor,b.fillColor=fillColor,b.opacity=1,b.on('mouseenter',function(){myui.fadeIn(0)}),b.on('mouseleave',function(){myui.fadeOut(1)}),settingsGroup.addChild(b),b.sendToBack(),this.settingsBox1=b,spacer.remove(),b=new Path.Rectangle(new Point(0,0),new Point(800,600),10),b.position=t.position+new Point(0,b.bounds.size.height/2+t.bounds.size.height/2+10),b.strokeColor=outlineColor,b.fillColor=fillColor,b.opacity=1,b.on('mouseenter',function(){myui.fadeIn(0)}),b.on('mouseleave',function(){myui.fadeOut(1)}),settingsGroup.addChild(b),this.settingsBox2=b,t=new PointText,t.justification='left',t.fontSize=viewport.controller.config.alertListFontSize+4,t.fillColor=outlineColor,t.content='Available Maps',t.opacity=1,t.position=b.bounds.topCenter+new Point(0,t.bounds.size.height/2+20),settingsGroup.addChild(t),counter=0,viewport.controller.config.maps.forEach(function(f,h){x=new PointText,x.justification='left',x.fontSize=viewport.controller.config.alertListFontSize+4,x.fillColor=outlineColor,x.content=h,x.opacity=1,x.on('mouseenter',function(){myui.fadeIn(0)}),x.on('mouseleave',function(){myui.fadeOut(1)}),x.on('mousedown',function(){viewport.reloadMap(h)}),settingsGroup.addChild(x),y=new Path.Rectangle(new Point(100,0),new Point(700,30),10),y.position=b.bounds.topCenter+new Point(0,y.bounds.size.height/2+t.bounds.size.height+35*counter+30),x.position=y.position,y.strokeColor=outlineColor,y.fillColor=fillColor,y.opacity=1,y.fillColor.brightness=.6,y.on('mouseenter',function(){myui.fadeIn(0),this.fillColor.brightness=.75}),y.on('mouseleave',function(){myui.fadeOut(1),this.fillColor.brightness=.6}),y.on('mousedown',function(){viewport.reloadMap(h),this.fillColor.brightness=.9}),y.on('mouseup',function(){this.fillColor.brightness=.75}),settingsGroup.addChild(y),x.bringToFront(),counter++}),t=new PointText,t.justification='left',t.fontSize=viewport.controller.config.alertListFontSize+4,t.fillColor=outlineColor,t.content='Last Update: Never',t.opacity=1,t.position=b.bounds.bottomLeft+new Point(t.bounds.size.width/2+10,-10-t.bounds.size.height/2),this.connectionText=t,settingsGroup.addChild(t),settingsGroup.position=e,settingsGroup};function init(){canvas=document.getElementById('myCanvas')}var viewport=null,ui=null;asyncStart();function asyncStart(){alertMapController.loaded?(init(),viewport=new Viewport(alertMapController),ui=new UIControls,ui.init()):setTimeout(asyncStart,10)}function asyncRestart(){alertMapController.loaded?(viewport=new Viewport(alertMapController),ui=new UIControls,ui.init()):setTimeout(asyncStart,10)}function onFrame(e){null!=viewport&&viewport.process(e.delta),null!=ui&&ui.doUpdates(e.delta)}function onMouseDrag(e){null!=viewport&&ui.scrollDisplay(e.delta)}function onKeyDown(e){'z'==e.key&&null!=viewport&&viewport.zoomIn(),'x'==e.key&&null!=viewport&&viewport.zoomOut()}